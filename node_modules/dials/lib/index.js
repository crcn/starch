var dref = require("dref"),
_        = require("underscore");

exports.load = function(options) {

	var ops = {
		env: process.env.NODE_ENV || "development",
		cwd: process.cwd(),
		path: ""
	};

	if(typeof options === "string") {	
		ops.path = options;
	} else {
		_.extend(ops, options);
	}

	//name of the application
	if(ops.path.split("/").length === 1) {

		var path;

		if(ops.env === "development") {
			path = ops.developmentPath || ops.cwd + "/config/config";
		} else {
			path = ops.productionPath || "/usr/local/etc/" + ops.path + "/config";
		}

		ops.path = path;
	}

	var all = require(ops.path),
	config  = _.extend({}, all.default || {}, all[ops.env] || {});

	return {
		get: function(path) {
			if(!path) return config;
			return dref.get(config, path);
		}
	}
}